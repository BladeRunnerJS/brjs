<head>
	<link rel="stylesheet" type="text/css" href="thirdparty/topiarist/spec/jasmine-1.3.0/jasmine.css" />
	<script type="text/javascript" src="thirdparty/topiarist/spec/jasmine-1.3.0/jasmine.js"></script>
	<script type="text/javascript" src="thirdparty/topiarist/spec/jasmine-1.3.0/jasmine-html.js"></script>
	<script type="text/javascript" src="locale-forwarder.js"></script>
	<script type="text/javascript">
		describe("locale-forwarder", function() {
			function locale(localeInfo) {
				var apps = {};
				for(var i = 0, l = localeInfo.app.length; i < l; ++i) {
					apps[localeInfo.app[i]] = true;
				}
				
				return getActiveLocale(localeInfo.cookie, localeInfo.user, apps);
			}
			
			it("uses the first matching user locale if no cookie is set.", function() {
				expect(locale({
					cookie:null,
					user:['de_CH', 'de'],
					app:['en', 'de']})).toBe("de");
			});
			
			it("uses the full locale if there is an available match.", function() {
				expect(locale({
					cookie:null,
					user:['de_CH', 'de'],
					app:['en', 'de', 'de_CH']})).toBe("de_CH");
			});
			
			it("uses the default locale if there are no other matches.", function() {
				expect(locale({
					cookie:null,
					user:['fr_FR', 'fr'],
					app:['en', 'de']})).toBe("en");
			});
			
			it("uses the cookie value in preference to the user-defined browser locales.", function() {
				expect(locale({
					cookie:'de',
					user:['en_GB', 'en'],
					app:['en', 'de']})).toBe("de");
			});
			
			it("ignores the cookie value if it is no longer one of the available locales.", function() {
				expect(locale({
					cookie:'en_GB',
					user:['de_DE', 'de'],
					app:['en', 'de']})).toBe("de");
			});
		});
	</script>
	<script type="text/javascript">
		(function() {
			var jasmineEnv = jasmine.getEnv();
			jasmineEnv.updateInterval = 1000;
			
			var htmlReporter = new jasmine.HtmlReporter();
			
			jasmineEnv.addReporter(htmlReporter);
			
			jasmineEnv.specFilter = function(spec) {
				return htmlReporter.specFilter(spec);
			};
			
			var currentWindowOnload = window.onload;
			
			window.onload = function() {
				if (currentWindowOnload) {
					currentWindowOnload();
				}
				execJasmine();
			};
			
			function execJasmine() {
				jasmineEnv.execute();
			}
		})();
	</script>
</head>
